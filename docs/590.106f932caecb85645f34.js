(self.webpackChunkposts=self.webpackChunkposts||[]).push([[590],{7590:(t,e,s)=>{"use strict";s.r(e),s.d(e,{PostsModule:()=>L});var o=s(8583),n=s(906),i=s(3018);let c=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-posts"]],decls:1,vars:0,template:function(t,e){1&t&&i._UZ(0,"router-outlet")},directives:[n.lC],styles:[""]}),t})();var r=s(6215),a=s(3342),p=s(8002),l=s(5197),d=s(509);function h(...t){return e=>{let s;return"function"==typeof t[t.length-1]&&(s=t.pop()),e.lift(new m(t,s))}}class m{constructor(t,e){this.observables=t,this.project=e}call(t,e){return e.subscribe(new g(t,this.observables,this.project))}}class g extends l.L{constructor(t,e,s){super(t),this.observables=e,this.project=s,this.toRespond=[];const o=e.length;this.values=new Array(o);for(let n=0;n<o;n++)this.toRespond.push(n);for(let n=0;n<o;n++)this.add((0,d.D)(this,e[n],void 0,n))}notifyNext(t,e,s){this.values[s]=e;const o=this.toRespond;if(o.length>0){const t=o.indexOf(s);-1!==t&&o.splice(t,1)}}notifyComplete(){}_next(t){if(0===this.toRespond.length){const e=[t,...this.values];this.project?this._tryProject(e):this.destination.next(e)}}_tryProject(t){let e;try{e=this.project.apply(this,t)}catch(s){return void this.destination.error(s)}this.destination.next(e)}}var u=s(2340),f=s(1841);let v=(()=>{class t{constructor(t){this.http=t,this._posts$=new r.X([]),this._loading$=new r.X(!1),this._pageInfo$=new r.X({page:1,limit:10,hasNext:!0}),this._selectedPost$=new r.X(null),this.url=`${u.N.apis.api}/posts`}get selectedPost$(){return this._selectedPost$.asObservable()}get posts$(){return this._posts$.asObservable()}get pageInfo$(){return this._pageInfo$.asObservable()}get loading$(){return this._loading$.asObservable()}loadPosts(){this._loading$.next(!0);const t=this._pageInfo$.value;this.http.get(this.url,{params:{_page:t.page,_limit:t.limit,_expand:"user"},observe:"response"}).pipe((0,a.b)(t=>{const e=this._pageInfo$.value;e.page++;const s=+(t.headers.get("x-total-count")||"0");e.hasNext=e.page<s/e.limit,this._pageInfo$.next(e)}),(0,p.U)(t=>t.body),h(this._posts$)).subscribe(([t,e])=>{const s=e.concat(t.filter(t=>!e.find(e=>e.id===t.id)));this._posts$.next(s),this._loading$.next(!1)},()=>this._loading$.next(!1))}loadPost(t){this.http.get(`${this.url}/${t}`,{params:{_expand:"user"}}).subscribe(t=>{this._selectedPost$.next(t)})}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(f.eN))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var x=s(7238);let Z=(()=>{class t{constructor(t){this.http=t,this.url=`${u.N.apis.api}/comments`,this.commentsStore$=new r.X({})}setLoading(t,e){const s=this.commentsStore$.value,o=Object.assign(Object.assign({},s),{[t]:Object.assign(Object.assign({},s[t]),{loading:e})});this.commentsStore$.next(o)}loadComments(t){var e,s;this.setLoading(t,!0);const o=this.commentsStore$.value[t],n=null!==(e=null==o?void 0:o.pageInfo)&&void 0!==e?e:{page:1,limit:10,hasNext:!0},i=null!==(s=null==o?void 0:o.comments)&&void 0!==s?s:[];this.http.get(this.url,{params:{_page:n.page,_limit:n.limit,postId:t},observe:"response"}).pipe((0,a.b)(t=>{n.page++;const e=+(t.headers.get("x-total-count")||"0");n.hasNext=n.page<e/n.limit}),(0,p.U)(t=>t.body)).subscribe(e=>{const s=i.concat(e.filter(t=>!i.find(e=>e.id===t.id))),o=this.commentsStore$.value;o[t]={comments:s,pageInfo:n,loading:!1},this.commentsStore$.next(o),this.setLoading(t,!1)},()=>this.setLoading(t,!1))}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(f.eN))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),b=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-comment-item"]],inputs:{comment:"comment"},decls:10,vars:3,consts:[[1,""],[1,"card-body","d-flex"],[1,"avatar"],[1,"letter"],[1,"flex-1","comment-content"],[1,"name"]],template:function(t,e){1&t&&(i.TgZ(0,"div",0),i.TgZ(1,"div",1),i.TgZ(2,"div",2),i.TgZ(3,"span",3),i._uU(4),i.qZA(),i.qZA(),i.TgZ(5,"div",4),i.TgZ(6,"div",5),i._uU(7),i.qZA(),i.TgZ(8,"div"),i._uU(9),i.qZA(),i.qZA(),i.qZA(),i.qZA()),2&t&&(i.xp6(4),i.Oqu(e.comment.name[0]),i.xp6(3),i.Oqu(e.comment.name),i.xp6(2),i.Oqu(e.comment.body))},styles:[".comment-content[_ngcontent-%COMP%]{background-color:#ccc;padding:8px;border-radius:1rem}"],changeDetection:0}),t})();function $(t,e){1&t&&(i.TgZ(0,"div",3),i._uU(1,"No comments"),i.qZA())}function I(t,e){if(1&t&&(i.TgZ(0,"div"),i._UZ(1,"app-comment-item",4),i.qZA()),2&t){const t=e.$implicit;i.xp6(1),i.Q6J("comment",t)}}function y(t,e){if(1&t){const t=i.EpF();i.TgZ(0,"div"),i.TgZ(1,"button",5),i.NdJ("click",function(){return i.CHM(t),i.oxw().loadComments()}),i._uU(2,"Load more comments"),i.qZA(),i.qZA()}}let O=(()=>{class t{constructor(t,e){var s;this.commentsService=t,this.cdr=e,this.showComments=!1;const o=this.commentsService.commentsStore$.pipe((0,p.U)(t=>t[this.postId]));this.comments$=o.pipe((0,p.U)(t=>null==t?void 0:t.comments)),this.loading$=o.pipe((0,p.U)(t=>null==t?void 0:t.loading)),this.hasNext$=o.pipe((0,p.U)(t=>{var e;return null===(e=null==t?void 0:t.pageInfo)||void 0===e?void 0:e.hasNext})),this.noComments$=null===(s=this.comments$)||void 0===s?void 0:s.pipe(h(this.loading$),(0,p.U)(([t,e])=>!(null==t?void 0:t.length)&&!e))}ngOnInit(){this.loadOnInit&&this.loadComments()}loadComments(){this.showComments=!0,this.cdr.detectChanges(),this.commentsService.loadComments(this.postId)}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(Z),i.Y36(i.sBO))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-comments"]],inputs:{postId:"postId",loadOnInit:"loadOnInit"},decls:7,vars:9,consts:[["class","text-center",4,"ngIf"],[4,"ngFor","ngForOf"],[4,"ngIf"],[1,"text-center"],[3,"comment"],[3,"click"]],template:function(t,e){1&t&&(i.TgZ(0,"div"),i.YNc(1,$,2,0,"div",0),i.ALo(2,"async"),i.YNc(3,I,2,1,"div",1),i.ALo(4,"async"),i.YNc(5,y,3,0,"div",2),i.ALo(6,"async"),i.qZA()),2&t&&(i.xp6(1),i.Q6J("ngIf",i.lcZ(2,3,e.noComments$)),i.xp6(2),i.Q6J("ngForOf",i.lcZ(4,5,e.comments$)),i.xp6(2),i.Q6J("ngIf",i.lcZ(6,7,e.hasNext$)))},directives:[o.O5,o.sg,b],pipes:[o.Ov],styles:["[_nghost-%COMP%]{display:block;margin-top:12px}"],changeDetection:0}),t})();const _=function(t){return["/posts",t]};function A(t,e){if(1&t){const t=i.EpF();i.TgZ(0,"div",8),i.TgZ(1,"a",9),i.NdJ("click",function(){i.CHM(t);const e=i.oxw(),s=i.MAs(11);return e.toggleState(),s.loadComments()}),i._UZ(2,"i",10),i.qZA(),i.TgZ(3,"a",11),i._UZ(4,"i",12),i.qZA(),i.qZA()}if(2&t){const t=i.oxw();i.xp6(3),i.Q6J("routerLink",i.VKq(1,_,t.post.id))}}let q=(()=>{class t{constructor(t){this.cdr=t,this.showFooter=!0,this.loadCommentsOnInit=!1}ngOnInit(){this.collapseState=this.showFooter?"hidden":"visible"}toggleState(){this.collapseState="visible"===this.collapseState?"hidden":"visible",this.cdr.detectChanges()}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(i.sBO))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-post-item"]],inputs:{post:"post",showFooter:"showFooter",loadCommentsOnInit:"loadCommentsOnInit"},decls:12,vars:7,consts:[[1,"card-header"],[1,"avatar"],[1,"letter"],[1,"name"],[1,"card-body"],["class","card-footer",4,"ngIf"],[3,"postId","loadOnInit"],["comments",""],[1,"card-footer"],[3,"click"],[1,"fa","fa-comment"],[3,"routerLink"],[1,"fa","fa-eye"]],template:function(t,e){1&t&&(i.TgZ(0,"div",0),i.TgZ(1,"div",1),i.TgZ(2,"span",2),i._uU(3),i.qZA(),i.qZA(),i.TgZ(4,"div",3),i._uU(5),i.qZA(),i.qZA(),i.TgZ(6,"div",4),i._uU(7),i.qZA(),i.YNc(8,A,5,3,"div",5),i.TgZ(9,"div"),i._UZ(10,"app-comments",6,7),i.qZA()),2&t&&(i.xp6(3),i.Oqu(e.post.user.name[0]),i.xp6(2),i.Oqu(e.post.user.name),i.xp6(2),i.Oqu(e.post.body),i.xp6(1),i.Q6J("ngIf",e.showFooter),i.xp6(1),i.Q6J("@collapse",e.collapseState),i.xp6(1),i.Q6J("postId",e.post.id)("loadOnInit",e.loadCommentsOnInit))},directives:[o.O5,O,n.yS],styles:["[_nghost-%COMP%]{display:block;width:100%;box-shadow:0 2px 5px 0 #00000029,0 2px 10px 0 #0000001f;margin-bottom:12px;background-color:#fff;border-radius:1rem;box-sizing:border-box}"],data:{animation:[(0,x.X$)("collapse",[(0,x.SB)("hidden",(0,x.oB)({height:"0",overflow:"hidden"})),(0,x.SB)("visible",(0,x.oB)({height:"100%",overflow:"hidden"})),(0,x.eR)("hidden <=> visible",(0,x.jt)(200))])]},changeDetection:0}),t})();function w(t,e){if(1&t&&(i.ynx(0),i._UZ(1,"app-post-item",2),i.BQk()),2&t){const t=e.ngIf;i.xp6(1),i.Q6J("post",t)("showFooter",!1)("loadCommentsOnInit",!0)}}let S=(()=>{class t{constructor(t,e){this.route=t,this.postsService=e,this.post$=this.postsService.selectedPost$}ngOnInit(){const t=this.route.snapshot.paramMap.get("id");t&&this.postsService.loadPost(+t)}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(n.gz),i.Y36(v))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-post-details"]],decls:3,vars:3,consts:[[1,"container"],[4,"ngIf"],[2,"padding","15px",3,"post","showFooter","loadCommentsOnInit"]],template:function(t,e){1&t&&(i.TgZ(0,"div",0),i.YNc(1,w,2,3,"ng-container",1),i.ALo(2,"async"),i.qZA()),2&t&&(i.xp6(1),i.Q6J("ngIf",i.lcZ(2,1,e.post$)))},directives:[o.O5,q],pipes:[o.Ov],styles:[""],changeDetection:0}),t})();var T=s(9112),C=s(5257);function N(t,e){if(1&t&&(i.TgZ(0,"div"),i._UZ(1,"app-post-item",5),i.qZA()),2&t){const t=e.$implicit;i.xp6(1),i.Q6J("post",t)}}function U(t,e){if(1&t){const t=i.EpF();i.TgZ(0,"div"),i.TgZ(1,"button",6),i.NdJ("click",function(){return i.CHM(t),i.oxw().loadMore()}),i._uU(2,"Load more"),i.qZA(),i.qZA()}}function k(t,e){1&t&&(i.TgZ(0,"div",7),i.TgZ(1,"div",8),i.TgZ(2,"span",9),i._uU(3,"Loading..."),i.qZA(),i.qZA(),i.qZA())}const P=[{path:"",component:c,children:[{path:":id",component:S},{path:"",component:(()=>{class t{constructor(t){this.postsService=t,this.posts$=this.postsService.posts$,this.loading$=this.postsService.loading$,this.hasNext$=(0,T.aj)([this.loading$,this.postsService.pageInfo$]).pipe((0,p.U)(([t,e])=>!t&&e.hasNext))}ngOnInit(){this.loadPosts()}loadPosts(){this.postsService.pageInfo$.pipe((0,C.q)(1)).subscribe(t=>{1===t.page&&this.postsService.loadPosts()})}loadMore(){this.postsService.pageInfo$.pipe((0,C.q)(1)).subscribe(t=>{t.hasNext&&this.postsService.loadPosts()})}trackById(t,e){return e.id}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(v))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-post-list"]],decls:10,vars:10,consts:[[1,"container"],[1,"text-center"],[4,"ngFor","ngForOf","ngForTrackBy"],[4,"ngIf"],["class","loading",4,"ngIf"],[3,"post"],[3,"click"],[1,"loading"],["role","status",1,"spinner"],[1,"sr-only"]],template:function(t,e){1&t&&(i.TgZ(0,"div",0),i.TgZ(1,"div"),i.TgZ(2,"h1",1),i._uU(3,"Welcome to MyApp"),i.qZA(),i.YNc(4,N,2,1,"div",2),i.ALo(5,"async"),i.YNc(6,U,3,0,"div",3),i.ALo(7,"async"),i.YNc(8,k,4,0,"div",4),i.ALo(9,"async"),i.qZA(),i.qZA()),2&t&&(i.xp6(4),i.Q6J("ngForOf",i.lcZ(5,4,e.posts$))("ngForTrackBy",e.trackById),i.xp6(2),i.Q6J("ngIf",i.lcZ(7,6,e.hasNext$)),i.xp6(2),i.Q6J("ngIf",i.lcZ(9,8,e.loading$)))},directives:[o.sg,o.O5,q],pipes:[o.Ov],styles:["[_nghost-%COMP%]{display:block;margin-bottom:25px}button[_ngcontent-%COMP%]{outline:none;border:none;padding:8px 10px;background-color:#1877f2;color:#fff;width:100%;margin:10px 0;cursor:pointer}.loading[_ngcontent-%COMP%]{display:flex;justify-content:center;margin:15px 0}"],changeDetection:0}),t})()}]}];let F=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[[n.Bz.forChild(P)],n.Bz]}),t})(),J=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[[o.ez]]}),t})(),L=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[[o.ez,F,J]]}),t})()}}]);